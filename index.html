<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Cat Farm (Coins + Battle Pets + Boss)</title>



<link rel="stylesheet" href="styles.css">


<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
  const SUPABASE_URL = "https://eqwdjutsmellvbqjvhzx.supabase.co";
  const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVxd2RqdXRzbWVsbHZicWp2aHp4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE1NjYzMTcsImV4cCI6MjA4NzE0MjMxN30.0U10MPyhKwchFuTdLEBOvSjx4yD6MhUKU9_lKuMnFb0";

  const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
  async function signUp(email, password) {
    const { data, error } = await supabase.auth.signUp({ email, password });
    if (error) throw error;
    return data;
  }

  async function signIn(email, password) {
    const { data, error } = await supabase.auth.signInWithPassword({ email, password });
    if (error) throw error;
    return data;
  }

  async function signOut() {
    const { error } = await supabase.auth.signOut();
    if (error) throw error;
  }


async function saveToCloud(gameStateObj) {
  const { data: authData } = await supabase.auth.getUser();
  const user = authData?.user;
  if (!user) throw new Error("Not logged in");

  const payload = {
    user_id: user.id,
    save: gameStateObj
  };

  const { error } = await supabase
    .from("game_saves")
    .upsert(payload, { onConflict: "user_id" });

  if (error) throw error;
}


async function loadFromCloud() {
  const { data: authData } = await supabase.auth.getUser();
  const user = authData?.user;
  if (!user) throw new Error("Not logged in");

  const { data, error } = await supabase
    .from("game_saves")
    .select("save")
    .eq("user_id", user.id)
    .single();

  if (error) {
    // If no row yet, return null instead of crashing
    if (error.code === "PGRST116") return null;
    throw error;
  }

  return data?.save ?? null;
}

</script>

</head>

<body>

<!-- MAIN MENU -->
<div id="menu">
  <div class="menuCard">
    <img src="images/title.png" alt="title" class="menuTitle">

    <div id="authModal" style="
      position: fixed; inset: 0; display: none; align-items: center; justify-content: center;
      background: rgba(0,0,0,0.55); z-index: 9999; font-family: system-ui, Arial;
    ">
      <div style="
        width: 360px; max-width: 92vw; background: #fff; border-radius: 14px;
        padding: 16px; box-shadow: 0 12px 40px rgba(0,0,0,0.25);
      ">
        <div style="display:flex; justify-content:space-between; align-items:center; gap:12px;">
          <div style="font-size: 16px; font-weight: 700;">Cloud Save</div>
          <button id="authClose" style="border:none; background:transparent; font-size:18px; cursor:pointer;">√ó</button>
        </div>

        <div style="margin-top: 10px; font-size: 13px; opacity: .85;">
          Log in to sync your progress across devices.
        </div>

        <div style="margin-top: 12px; display:flex; flex-direction:column; gap:10px;">
          <input id="authEmail" type="email" placeholder="Email"
            style="padding:10px 12px; border:1px solid #ddd; border-radius:10px; outline:none;">
          <input id="authPassword" type="password" placeholder="Password"
            style="padding:10px 12px; border:1px solid #ddd; border-radius:10px; outline:none;">
        </div>

        <div style="margin-top: 12px; display:flex; gap:10px;">
          <button id="btnLogin" style="
            flex:1; padding:10px 12px; border:none; border-radius:10px; cursor:pointer;
            background:#111; color:#fff; font-weight:600;
          ">Log in</button>

          <button id="btnSignup" style="
            flex:1; padding:10px 12px; border:1px solid #111; border-radius:10px; cursor:pointer;
            background:#fff; color:#111; font-weight:600;
          ">Sign up</button>
        </div>

        <div style="margin-top: 10px; display:flex; justify-content:space-between; align-items:center;">
          <button id="btnLogout" style="
            padding:8px 10px; border:1px solid #ddd; border-radius:10px; cursor:pointer; background:#fff;
          ">Log out</button>
          <div id="authStatus" style="font-size: 12px; opacity:.85; text-align:right;"></div>
        </div>
      </div>
    </div>

    <!-- Optional: a button you can place anywhere to open login -->
    <button id="openAuth" style="
      position: fixed; right: 14px; bottom: 14px; z-index: 9998;
      padding:10px 12px; border-radius: 12px; border: none; cursor: pointer;
    ">Cloud</button>

    <button onclick="startGame()"><span>Play</span></button>
    <div class="buttonGroup2">
      <button onclick="openInfo()" class="button2"><span>What's New</span></button>
      <button onclick="openInfo()" class="button2"><span>Leaderboard</span></button>
    </div>
  </div>
</div>

<!-- GAME -->
<div id="game">
  <div id="toast"><span>‚ö†Ô∏è</span><span id="toastText">A wild pet has appeared!</span></div>

  <div class="header">
    <div class="profileArea">
      <div class="dpandlevelcon">
        <div class="profilecon" id="profileBtn" onclick="openProfile()" onerror="this.style.display='none'">
        <img src="images/profile.png" alt="profile"/>
      </div>
      <div id="LevelTxtCon"><h3 id="LevelTxt"></h3></div>
      </div>
      <div class="nameStack">
        <div id="playerNameDisplay">Player</div>
        <div id="playerTitleDisplay">Rookie Farmer</div>
          <div id="xpBarContainer">
          <div id="xpBar"></div>
          <div id="xpLevelText">Lvl 1</div>
        </div>
        
      </div>
    </div>

    <div class="coinCon">
      <div class="coinbox" id="coinBox">
        <img src="images/coin.png" alt="coin" onerror="this.style.display='none'"/>
        <span id="coins">0</span>
      </div>

      <div class="coinbox" id="petBox" title="Captured pets">
        <span style="font-size:18px;">üêæ</span>
        <span id="petCount">0</span>
      </div>
    </div>
    
  </div>



  <!-- FARM SCREEN -->
  <div id="farmScreen" class="screen">
     
    <div class="farmcon">

      <div class="townZooCon" >
        <button onclick="openZoo()" class="toZooBtn"><span data-title="Ranch">Ranch</span></button>
        <button onclick="showTown()" class="toTownBtn"><span data-title="Town">Town</span></button>
      </div>

      <div class="toolStrip" id="toolStrip">
        <!-- Arrow indicator -->
        <div id="toolsArrow"><img src="images/toolArrow.png" alt="toolArrow"></div>
        <!-- Expanding list of tools -->
        <div id="toolsPanel">
          <button class="toolBtn" id="toolHarvestBtn" onclick="setTool('harvest')"><img src="images/harvesttool.png" alt="Harvest"><span data-title="Harvest">Harvest</span></button>
          <button class="toolBtn active" id="toolPlantBtn"  onclick="setTool('plant')"><img src="images/planttool.png" alt="Plant"><span data-title="Plant">Plant</span></button>
          <button class="toolBtn" id="toolMoveBtn" onclick="setTool('move')"><img src="images/movetool.png" alt="Move"><span data-title="Move">Move</span></button>
          <button class="toolBtn"  id="toolRemoveBtn" onclick="setTool('remove')"><img src="images/removetool.png" alt="Remove"><span data-title="Remove">Remove</span></button>
        </div>
        <!-- Main Button -->
        <button class="toolBtn" id="toolsToggleBtn" type="button"> <img id="currentToolIcon" src="images/harvesttool.png" alt="Current Tool"><span data-title="Tool">Tool</span></button>
      </div>
      <img src="images/fence.png" alt="fence1" class="fence1" onerror="this.style.display='none'"/>
      <div id="farmWrap">
        <div id="eventLayer"></div>
        <div id="farm"></div>
      </div>
      <img src="images/fence.png" alt="fence2" class="fence2" onerror="this.style.display='none'"/>
    </div>
  </div>

 

  <!-- TOWN SCREEN -->
  <div id="townScreen" class="screen">

      <div class="header">
        <div class="profileArea">
          <div class="dpandlevelcon">
            <div class="profilecon" id="profileBtn" onclick="openProfile()" onerror="this.style.display='none'">
            <img src="images/profile.png" alt="profile"/>
          </div>
          <div id="LevelTxtCon"><h3 id="LevelTxt" data-title="1">1</h3></div>
          </div>
          <div class="nameStack">
            <div id="playerNameDisplay">Player</div>
            <div id="playerTitleDisplay">Rookie Farmer</div>
              <div id="xpBarContainer">
              <div id="xpBar"></div>
              <div id="xpLevelText" data-title="Lvl 1">0/90</div>
            </div>
            
          </div>
        </div>

        <div class="coinCon">
          <div class="coinbox" id="coinBox">
            <img src="images/coin.png" alt="coin" onerror="this.style.display='none'"/>
            <span id="coins">0</span>
          </div>

          <div class="coinbox" id="petBox" title="Captured pets">
            <span style="font-size:18px;">üêæ</span>
            <span id="petCount">0</span>
          </div>
        </div>
    </div>

    <div class="townGrid">
      <button class="towntoRanchBtn" id="townToggleBtn2" onclick="openZoo()" title="Town / Farm"> <span id="townBtnIcon" data-title="Ranch">Ranch</span></button>
      <div class="building" id="buildingArena" onclick="openArena()">
        <div class="name" data-title="Arena">Arena</div>
        <div class="tag">Battle (PvP)</div>
      </div>

      <div class="building" id="buildingMarket" onclick="openSupermarket()">
        <div class="name" data-title="Supermarket">Supermarket</div>
        <div class="tag">Boosts + Limited Seeds</div>
      </div>

      <div class="building" id="buildingLibrary" onclick="openLibrary()">
        <div class="name" data-title="Library">Library</div>
        <div class="tag">Library exam (daily)</div>
      </div>
      
      <div class="building" id="buildingQuestBoard" onclick="openQuestBoard()">
        <div class="name" data-title="Quest Board">Quest Board</div>
        <div class="tag">Daily quests + streak</div>
      </div>

      <button class="towntoFarmBtn" id="townToggleBtn" onclick="toggleTown()" title="Town / Farm"> <span id="townBtnIcon" data-title="Farm">Farm</span></button>

    </div>
    <div class="townHint">Wild pets enter from the side. Clean poop for rewards!</div>
  </div>

  <!-- ZOO SCREEN -->
  <div id="zooScreen" class="screen">
    <!-- <div class="zooTitle">Zoo</div>
    <div class="zooSub">Your captured pets can roam freely here.</div> -->
    
    <div id="zooYard" title="Tap a pet to view details">

      <div class="townZooCon2" >
        <button onclick="toggleTown()" class="toFarmBtn2"><span data-title="Farm">Farm</span></button>
        <button onclick="showTown()" class="toTownBtn2"><span data-title="Town">Town</span></button>
      </div>

      <img src="images/fence.png" alt="fence1" class="fence1" onerror="this.style.display='none'"/>

        <div id="zooRoamLayer"></div>
        <div id="zooEmpty" class="zooEmpty"><span>No pets yet. Capture wild pets on your farm!</span></div>

      <img src="images/fence.png" alt="fence2" class="fence2" onerror="this.style.display='none'"/>
    </div>
    

    <div id="zooStats" class="zooStats">Pets: <b>0</b></div>
    <div class="zooHint" data-title="Tip: Open Town üèòÔ∏è to visit the Library and Quest Board.">Tip: Open Town üèòÔ∏è to visit the Library and Quest Board.</div>

    <div class="zooNav">
      <button class="bottomBtn" id="btnCrops" onclick="openArena()">
        <img src="images/crops.png" alt="crops" onerror="this.style.display='none'"><span data-title="Arena">Arena</span>
      </button>
    </div>
    
  </div>


  <!-- Bottom nav -->
  <div class="bottomNav">
    <div id="bottomBar">
      <button class="bottomBtn" id="btnCrops" onclick="openCrops()">
        <img src="images/crops.png" alt="crops" onerror="this.style.display='none'"><span data-title="Crops">Crops</span>
      </button>
      <button class="bottomBtn" onclick="openHarvestShop()">
        <img src="images/shop.png" alt="market"> <span data-title="Market">Market</span>
      </button>
      <button class="bottomBtn" onclick="openInventory()">
        <img src="images/inventory.png" alt="bag"> <span data-title="Inventory">Inventory</span>
      </button>
      <button class="bottomBtn" id="btnZoo" onclick="openZoo()">
        <img src="images/zoo.png" alt="zoo" onerror="this.style.display='none'"> <span data-title="Ranch">Ranch</span>
      </button>
    </div>
  </div>
</div>

<!-- TUTORIAL OVERLAY (Spotlight + Arrow) -->
<div id="tutorialOverlay" title="Click anywhere to continue ‚Ä¢ Double-click to skip">
  <div class="tutorialBlocker"></div>
  <div id="tutorialHighlight"></div>
  <svg id="tutorialArrowSvg" viewBox="0 0 100 100" preserveAspectRatio="none"></svg>
  <div id="tutorialBubble">
    <div id="tutorialMascot">üê±</div>
    <div id="tutorialRight">
      <div id="tutorialTitle">Mao the Cat</div>
      <div id="tutorialText"></div>
      <div id="tutorialHint">Click anywhere to continue ‚Ä¢ Double-click anywhere to skip</div>
    </div>
  </div>
</div>

<!-- MODAL -->
<div id="modal" class="modal">
  <div class="modalBox">
    <div class="modalHeader">
      <div id="modalTitleCon"><h2 id="modalTitle"></h2></div>
      <button class="modalClose" onclick="closeModal()"></button>
    </div>
    <div id="modalContent"></div>
  </div>
</div>

<script src="script.js"></script>

</body>
</html>
